---
import Header from '../components/Header.astro';

export interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SRLHMVN1J3"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="theme-color" content="#dc2626" />

    <!-- Primary Meta Tags -->
    <title>{title} | Sailor Success</title>
    <meta name="title" content={`${title} | Sailor Success`} />
    <meta name="description" content={description} />
    <meta name="author" content="Sailor Success" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Sailor Success" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={`${title} | Sailor Success`} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="https://sailorsuccess.online/images/og-default.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="en_IN" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@sailorsuccess" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={`${title} | Sailor Success`} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="https://sailorsuccess.online/images/og-default.jpg" />

    <!-- Canonical -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Fonts: Inter + Source Serif -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&display=swap" rel="stylesheet" />
  </head>

  <body class="bg-gray-950 text-gray-100 antialiased" style="font-family: 'Inter', sans-serif;">

    <!-- NEW: Astro Header Component with Hamburger Menu -->
    <Header />

    <!-- Page Content -->
    <slot />

    <!-- Footer -->
    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <a href="/" class="footer-logo">
            <img src="/images/logo.png" alt="Sailor Success" class="footer-logo-img" width="140" height="40" onerror="this.style.display='none'" />
          </a>
          <p class="footer-tagline">Empowering seafarers worldwide with knowledge, tools and career guidance.</p>
          <div class="footer-social">
            <a href="https://sailorsuccess.graphy.com/talk/mentor" target="_blank" rel="noopener" class="sailorgpt-footer-btn">
              ü§ñ SailorGPT
            </a>
          </div>
        </div>
        <div class="footer-links">
          <div class="footer-column">
            <h4>Knowledge</h4>
            <ul>
              <li><a href="/learn">Learn</a></li>
              <li><a href="/careers">Careers</a></li>
              <li><a href="/rights">Rights</a></li>
              <li><a href="/encyclopedia">Encyclopedia</a></li>
              <li><a href="/blog">Blog</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Resources</h4>
            <ul>
              <li><a href="/tools">Tools</a></li>
              <li><a href="/money">Money</a></li>
              <li><a href="/finance">Finance</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Support</h4>
            <ul>
              <li><a href="/about">About</a></li>
              <li><a href="/contact">Contact</a></li>
              <li><a href="/contributors">Our Contributors</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; {new Date().getFullYear()} Sailor Success. All rights reserved.</p>
        <p>Made with ‚ù§Ô∏è for seafarers worldwide</p>
      </div>
    </footer>

    <!-- Floating CTA Stack -->
    <div class="floating-cta-stack" id="floating-cta-stack">
      <a href="https://sailorsuccess.graphy.com/talk/mentor" target="_blank" rel="noopener" class="floating-btn sailorgpt-btn" title="Chat with SailorGPT">
        <span class="btn-icon">ü§ñ</span>
        <span class="btn-label">SailorGPT</span>
      </a>
      <button class="floating-btn whatsapp-btn" id="lead-capture-btn" title="Get Free Guide on WhatsApp">
        <span class="btn-icon">üì±</span>
        <span class="btn-label">Free Guide</span>
      </button>
    </div>

    <!-- Lead Capture Popup -->
    <div class="popup-overlay" id="popup-overlay">
      <div class="popup-container">
        <button class="popup-close" id="popup-close" aria-label="Close">&times;</button>
        <div class="popup-header">
          <div class="popup-icon">üö¢</div>
          <h3>Get Your Free Maritime Guide</h3>
          <p>Join 10,000+ seafarers getting weekly career tips</p>
        </div>
        <form class="popup-form" id="lead-form">
          <div class="form-row">
            <input type="text" id="lead-name" name="name" placeholder="Your Name" required />
            <input type="tel" id="lead-whatsapp" name="whatsapp" placeholder="WhatsApp Number" required />
          </div>
          <select id="lead-role" name="role" required>
            <option value="">Select Your Role</option>
            <option value="cadet">Cadet / Trainee</option>
            <option value="officer">Officer (Deck/Engine)</option>
            <option value="master">Master / Chief Engineer</option>
            <option value="shore">Shore-based Maritime</option>
            <option value="aspiring">Aspiring Seafarer</option>
          </select>
          <button type="submit" class="popup-submit">Send Me the Free Guide üöÄ</button>
        </form>
        <p class="popup-disclaimer">üîí No spam. Unsubscribe anytime.</p>
      </div>
    </div>

    <!-- Search Enhancement + UI Script -->
    <script src="/ss-enhance.js" defer></script>

    <!-- Lead Capture Script -->
    <script>
      const WEBHOOK_URL = 'https://hook.eu2.make.com/YOURWEBHOOKID'; // Replace with real Make.com URL when ready

      const leadBtn = document.getElementById('lead-capture-btn');
      const overlay = document.getElementById('popup-overlay');
      const closeBtn = document.getElementById('popup-close');
      const form = document.getElementById('lead-form');

      if (leadBtn && overlay) {
        leadBtn.addEventListener('click', () => overlay.classList.add('active'));
        closeBtn?.addEventListener('click', () => overlay.classList.remove('active'));
        overlay.addEventListener('click', (e) => {
          if (e.target === overlay) overlay.classList.remove('active');
        });
      }

      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const data = {
            name: (document.getElementById('lead-name') as HTMLInputElement)?.value,
            whatsapp: (document.getElementById('lead-whatsapp') as HTMLInputElement)?.value,
            role: (document.getElementById('lead-role') as HTMLSelectElement)?.value,
            page: window.location.href,
            timestamp: new Date().toISOString()
          };
          try {
            await fetch(WEBHOOK_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });
            overlay?.classList.remove('active');
            alert('‚úÖ Guide sent to your WhatsApp!');
          } catch (err) {
            alert('‚úÖ Received! Check WhatsApp shortly.');
          }
        });
      }
    </script>

  </body>
</html>
