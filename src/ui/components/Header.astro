---
import SearchBox from './SearchBox.astro';
const currentPath = Astro.url.pathname;

const mainNav = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/contact', label: 'Contact' },
  { href: 'https://sailorsuccess.graphy.com/store', label: 'Courses', external: true },
  { href: '/contributors', label: 'Our Contributors' },
];

const categoryNav = [
  { href: '/learn', label: 'Learn', icon: 'ğŸ“š' },
  { href: '/careers', label: 'Career', icon: 'ğŸš¢' },
  { href: '/rights', label: 'Rights', icon: 'âš–ï¸' },
  { href: '/tools', label: 'Tools', icon: 'ğŸ”§' },
  { href: '/money', label: 'Money', icon: 'ğŸ’°' },
  { href: '/blog', label: 'Blog', icon: 'âœï¸' },
  { href: '/encyclopedia', label: 'Encyclopedia', icon: 'ğŸ“–' },
  { href: 'https://sailorsuccess.graphy.com/talk/mentor', label: 'SailorGPT', icon: 'ğŸ¤–', external: true },
  { href: 'https://wa.me/919958110235?text=help%20me%20chief', label: 'Talk to Chief', icon: 'ğŸ“', external: true },
];
---

<header class="fixed top-0 left-0 right-0 z-50 backdrop-blur-xl bg-gray-950/90 border-b border-red-600/25 shadow-lg shadow-black/40">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">

      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 group flex-shrink-0">
        <img
          src="/images/logo.png"
          alt="Sailor Success"
          class="h-10 w-auto transition-transform duration-200 group-hover:scale-105"
          onerror="this.style.display='none'"
        />
        <span class="font-extrabold text-lg text-white tracking-tight hidden sm:block">
          Sailor<span class="text-red-500">Success</span>
        </span>
      </a>

      <!-- Desktop Main Nav -->
      <nav class="hidden lg:flex items-center gap-1">
        {mainNav.map(item => (
          <a
            href={item.href}
            class={`text-sm font-medium px-3 py-2 rounded-lg transition-colors duration-150 hover:text-red-400 hover:bg-red-500/10 whitespace-nowrap ${
              currentPath === item.href ? 'text-red-400 bg-red-500/10' : 'text-gray-300'
            } ${item.external ? 'text-yellow-300 hover:text-yellow-200' : ''}`}
            {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
          >
            {item.label}
          </a>
        ))}
        <!-- SailorGPT CTA in desktop nav -->
        <a
          href="https://sailorsuccess.graphy.com/talk/mentor"
          target="_blank"
          rel="noopener noreferrer"
          class="ml-2 px-4 py-2 bg-red-600/20 hover:bg-red-600/30 border border-red-500/30 text-red-300 hover:text-red-200 text-sm font-semibold rounded-lg transition-colors duration-150 whitespace-nowrap"
        >
          SailorGPT âœ¨
        </a>
      </nav>

      <!-- Right side: Search + Hamburger -->
      <div class="flex items-center gap-3">
        <div class="hidden md:block">
          <SearchBox />
        </div>

        <!-- Hamburger button -->
        <button
          id="ss-hamburger"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="ss-mobile-menu"
          class="flex flex-col justify-center items-center w-10 h-10 rounded-lg bg-red-600/10 hover:bg-red-600/25 border border-red-600/25 transition-all duration-200 gap-1.5"
        >
          <span class="ss-bar block w-5 h-0.5 bg-red-400 transition-all duration-300 origin-center"></span>
          <span class="ss-bar block w-5 h-0.5 bg-red-400 transition-all duration-300"></span>
          <span class="ss-bar block w-5 h-0.5 bg-red-400 transition-all duration-300 origin-center"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile + Desktop Hamburger Menu -->
  <div
    id="ss-mobile-menu"
    class="hidden border-t border-red-600/20 bg-gray-950/97 backdrop-blur-2xl"
  >
    <div class="max-w-7xl mx-auto px-4 py-5 space-y-4">

      <!-- Main Nav Links (shown in hamburger for all screen sizes) -->
      <div class="space-y-1">
        {mainNav.map(item => (
          <a
            href={item.href}
            class={`flex items-center gap-3 px-4 py-2.5 rounded-xl text-sm font-medium transition-colors ${
              currentPath === item.href
                ? 'bg-red-600/20 text-red-400 border border-red-500/30'
                : 'text-gray-300 hover:bg-red-600/10 hover:text-red-400'
            } ${item.external ? 'text-yellow-300 hover:text-yellow-200' : ''}`}
            {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
          >
            {item.label}
          </a>
        ))}
      </div>

      <!-- Divider -->
      <div class="border-t border-red-600/10"></div>

      <!-- Category Nav -->
      <div>
        <p class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-widest mb-3">Explore by Category</p>
        <div class="grid grid-cols-2 gap-1">
          {categoryNav.map(item => (
            <a
              href={item.href}
              class={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-colors ${
                item.label === 'SailorGPT'
                  ? 'text-red-300 hover:bg-red-600/20 hover:text-red-200 border border-red-500/20'
                  : item.label === 'Talk to Chief'
                  ? 'text-green-400 hover:bg-green-600/10 hover:text-green-300 border border-green-500/20'
                  : 'text-gray-300 hover:bg-red-600/10 hover:text-red-400'
              }`}
              {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
            >
              <span class="text-base">{item.icon}</span>
              {item.label}
            </a>
          ))}
        </div>
      </div>

      <!-- Mobile Search -->
      <div class="md:hidden pt-1">
        <SearchBox />
      </div>
    </div>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-16"></div>

<script>
  (() => {
    const btn = document.getElementById('ss-hamburger');
    const menu = document.getElementById('ss-mobile-menu');
    if (!btn || !menu) return;

    const bars = btn.querySelectorAll('.ss-bar');

    const openMenu = () => {
      menu.classList.remove('hidden');
      btn.setAttribute('aria-expanded', 'true');
      bars[0].style.transform = 'translateY(7px) rotate(45deg)';
      bars[1].style.opacity = '0';
      bars[2].style.transform = 'translateY(-7px) rotate(-45deg)';
    };

    const closeMenu = () => {
      menu.classList.add('hidden');
      btn.setAttribute('aria-expanded', 'false');
      bars[0].style.transform = '';
      bars[1].style.opacity = '';
      bars[2].style.transform = '';
    };

    btn.addEventListener('click', () => {
      btn.getAttribute('aria-expanded') === 'true' ? closeMenu() : openMenu();
    });

    document.addEventListener('click', (e) => {
      if (!btn.contains(e.target) && !menu.contains(e.target)) closeMenu();
    });

    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1024) closeMenu();
    });

    menu.querySelectorAll('a').forEach(a => a.addEventListener('click', closeMenu));
  })();
</script>
